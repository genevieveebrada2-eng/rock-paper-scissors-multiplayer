<!DOCTYPE html>
<html lang="en">
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Rock Paper Scissors â€“ Ultimate Multiplayer</title>
<link rel="manifest" href="manifest.json">
<style>
  body { font-family: Arial, sans-serif; background: linear-gradient(135deg,#ffd6e8,#e0f2fe); text-align:center; padding:20px; }
  .card { background:white; border-radius:20px; padding:20px; max-width:400px; margin:20px auto; box-shadow:0 10px 20px rgba(0,0,0,0.15); }
  h1,h2 { color:#ff69b4; }
  input,button { padding:10px; margin:5px; border-radius:12px; border:none; font-size:16px; }
  button { background:#ffb3d9; cursor:pointer; }

  #rpsStage {
    position: relative;
    height: 160px;
    overflow: hidden;
    margin: 10px 0;
  }

  .hand {
    position: absolute;
    top: -80px;
    font-size: 64px;
    animation: fall 0.7s ease-out forwards;
    transform-origin: center;
  }

  .hand.you { left: 30px; animation: fallRotateBounce 0.7s ease-out forwards; }
  .hand.enemy { right: 30px; animation: fallRotateBounce 0.7s ease-out forwards; }

  .label {
    font-size: 12px;
    margin-top: 2px;
    color: #555;
  }

  @keyframes fall {
    from { top: -80px; }
    to { top: 30px; }
  }

  @keyframes fallRotateBounce {
    0% { top: -80px; transform: rotate(0deg); }
    60% { top: 40px; transform: rotate(15deg); }
    80% { top: 25px; transform: rotate(-10deg); }
    100% { top: 30px; transform: rotate(0deg); }
  }

  #chat { height:120px; overflow-y:auto; background:#fdf2f8; padding:10px; border-radius:10px; text-align:left; margin-bottom:10px; }
  #avatar { width:80px; height:80px; border-radius:50%; margin-top:10px; }
  #emojiPicker button { font-size:20px; margin:2px; }

  .special-msg {
    font-size: 24px;
    font-weight: bold;
    color: #ff69b4;
    position: absolute;
    width: 100%;
    top: 50px;
    left: 0;
    animation: fadeOut 3s forwards;
  }

  @keyframes fadeOut {
    0% { opacity: 1; }
    100% { opacity: 0; }
  }
</style>
</head>
<body>

<div class="card" id="joinBox">
  <h1>âœŠğŸ»ğŸ–ğŸ»âœŒğŸ» ROCK PAPER SCISSORS</h1>
  <input id="name" placeholder="Your name"><br>
  <input id="room" placeholder="Room code (same for both players)"><br>
  <button onclick="startAuth()">Join Room</button>
  <button onclick="playBot()">Play Bot ğŸ¤–</button>
</div>

<div class="card" id="gameBox" style="display:none;">
  <h2 id="status">Waiting...</h2>
  <p>Wins: <span id="wins">0</span> | Losses: <span id="losses">0</span> | Draws: <span id="draws">0</span></p>

  <div id="rpsStage"></div>

  <div>
    <button onclick="play('rock')">âœŠğŸ»</button>
    <button onclick="play('paper')">ğŸ–ğŸ»</button>
    <button onclick="play('scissors')">âœŒğŸ»</button>
  </div>

  <h3>Chat ğŸ’¬</h3>
  <div id="chat"></div>
  <input id="msg" placeholder="Type message...">
  <button onclick="sendMsg()">Send</button>

  <div id="emojiPicker">
    <button onclick="sendEmoji('ğŸ˜€')">ğŸ˜€</button>
    <button onclick="sendEmoji('ğŸ˜‚')">ğŸ˜‚</button>
    <button onclick="sendEmoji('ğŸ”¥')">ğŸ”¥</button>
    <button onclick="sendEmoji('ğŸ’¥')">ğŸ’¥</button>
  </div>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<!-- Confetti -->
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyAfjWHdqOA2gvJbo89KUu80CMjFVZFnAa8",
  authDomain: "nera-xien.firebaseapp.com",
  projectId: "nera-xien",
  messagingSenderId: "403251362936",
  appId: "1:403251362936:web:dfba26db97da4bb21fc18d"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

let roomCode, playerId, playerName;
let wins=0, losses=0, draws=0, botMode=false;
let points = 0;

const emojiMap = { rock:"âœŠğŸ»", paper:"ğŸ–ğŸ»", scissors:"âœŒğŸ»" };
const specialNames = ["Ivy","Genevieve","Vina","Genie"];
const specialEmail = "genevieveebrada2@gmail.com";

const statusEl = document.getElementById("status");
const winsEl = document.getElementById("wins");
const lossesEl = document.getElementById("losses");
const drawsEl = document.getElementById("draws");
const chatEl = document.getElementById("chat");
const msgEl = document.getElementById("msg");
const joinBox = document.getElementById("joinBox");
const gameBox = document.getElementById("gameBox");
const stage = document.getElementById("rpsStage");

// ğŸ”Š Sounds
const clickSound = new Audio("https://assets.mixkit.co/sfx/preview/mixkit-game-click-1114.mp3");
const winSound = new Audio("https://assets.mixkit.co/sfx/preview/mixkit-winning-chimes-2015.mp3");
const loseSound = new Audio("https://assets.mixkit.co/sfx/preview/mixkit-retro-arcade-lose-2027.mp3");

// ğŸ† Rank system
function getRank() {
  if (points >= 10) return "Gold ğŸ¥‡";
  if (points >= 5) return "Silver ğŸ¥ˆ";
  return "Bronze ğŸ¥‰";
}

// ğŸ•’ Countdown
function countdownThenShow(you, enemy) {
  let count = 3;
  stage.innerHTML = `<h2>${count}</h2>`;
  const timer = setInterval(() => {
    count--;
    if (count > 0) {
      stage.innerHTML = `<h2>${count}</h2>`;
    } else {
      clearInterval(timer);
      showHands(you, enemy);
    }
  }, 700);
}

function startAuth(){
  const email=prompt("Enter email:");
  const password=prompt("Enter password:");
  firebase.auth().signInWithEmailAndPassword(email,password)
  .then(()=>joinRoom())
  .catch(err=>{
    if(err.code==="auth/user-not-found"){
      firebase.auth().createUserWithEmailAndPassword(email,password).then(()=>joinRoom());
    } else alert(err.message);
  });
}

function joinRoom(){
  playerName=document.getElementById("name").value||"Player";
  roomCode=document.getElementById("room").value||("room-"+Date.now());
  playerId=firebase.auth().currentUser.uid;

  db.ref("rooms/"+roomCode+"/players/"+playerId).set({name:playerName,move:""});
  joinBox.style.display="none";
  gameBox.style.display="block";
  listenMoves();
  listenChat();
}

function showHands(you, enemy){
  stage.innerHTML = `
    <div class="hand you">${emojiMap[you]}<div class="label">You</div></div>
    <div class="hand enemy">${emojiMap[enemy]}<div class="label">Opponent</div></div>
    <p>ğŸ† Rank: ${getRank()} | â­ Points: ${points}</p>
  `;
}

function listenMoves(){
  db.ref("rooms/"+roomCode).on("value",snap=>{
    const d=snap.val(); if(!d||!d.players) return;
    const ids=Object.keys(d.players);
    if(ids.length===2){
      const a=d.players[ids[0]].move;
      const b=d.players[ids[1]].move;
      if(a&&b) handleResult(a,b);
    }
  });
}

function handleResult(a,b){
  countdownThenShow(a,b);

  setTimeout(() => {
    if(a===b){
      draws++; 
      statusEl.innerText="Draw!";
    }
    else if((a==="rock"&&b==="scissors")||(a==="paper"&&b==="rock")||(a==="scissors"&&b==="paper")){
      wins++; 
      points++;
      winSound.play();
      statusEl.innerText="You win!";
      // Special text for names / Gmail
      if(specialNames.includes(playerName) || firebase.auth().currentUser.email === specialEmail){
        const specialMsg = document.createElement("div");
        specialMsg.className = "special-msg";
        specialMsg.innerText = "ğŸ‰ You win, baby! ğŸ‰";
        stage.appendChild(specialMsg);
        confetti({particleCount:150, spread:70, origin:{y:0.6}});
      } else {
        confetti({particleCount:100, spread:70, origin:{y:0.6}});
      }
    } else { 
      losses++; 
      points = Math.max(0, points-1);
      loseSound.play();
      statusEl.innerText="You lose!";
      confetti({particleCount:80, spread:60, origin:{y:0.6}});
    }

    winsEl.innerText=wins;
    lossesEl.innerText=losses;
    drawsEl.innerText=draws;

    db.ref("rooms/"+roomCode+"/players").once("value").then(s=>{
      s.forEach(p=>db.ref("rooms/"+roomCode+"/players/"+p.key+"/move").set(""));
    });
  }, 2200);
}

function play(c){
  clickSound.play();
  if(botMode){
    const b=["rock","paper","scissors"][Math.floor(Math.random()*3)];
    handleResult(c,b);
  } else {
    db.ref("rooms/"+roomCode+"/players/"+playerId+"/move").set(c);
  }
}

function playBot(){
  botMode=true;
  joinBox.style.display="none";
  gameBox.style.display="block";
}

function sendMsg(){ 
  const m=msgEl.value; 
  if(m) db.ref("rooms/"+roomCode+"/chat").push(playerName+": "+m); 
  msgEl.value=""; 
}
function sendEmoji(e){ db.ref("rooms/"+roomCode+"/chat").push(playerName+": "+e); }
function listenChat(){ 
  db.ref("rooms/"+roomCode+"/chat").on("child_added",s=>{
    chatEl.innerHTML += "<div>"+s.val()+"</div>";
    chatEl.scrollTop = chatEl.scrollHeight;
  }); 
}
</script>
</body>
</html>
